<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" 
	"http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd">
<html xml:lang="fr" lang="fr" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
<meta name='generator' content='SPIP 2.1.26' />
<meta name='language' content='fr' />
<meta name='description' content='PACS 2013 2014' />
<link rel='stylesheet' type='text/css' media='all'
	href='https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/LI355-2014fev/spip.php?page=config-placement.css' />
<link rel='stylesheet' type='text/css' media='screen, projection' 
	href='https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/LI355-2014fev/spip.php?page=config.css&amp;spec=Licence' />
<link rel='stylesheet' type='text/css'  media='print'
	href='https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/extensions/DidacSPIP/css/impression.css' />
<link rel='stylesheet' type='text/css' 
	media='handheld, only screen and (max-device-width: 480px)'
	href='https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/extensions/DidacSPIP/css/handheld.css' />
<link rel="alternate"
	type="application/rss+xml"
	title="Syndiquer cette rubrique"
	href="https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/?page=backend&amp;id_rubrique[]=1&amp;id_rubrique[]=283"
/><link rel="search" type="application/opensearchdescription+xml" 
	href="https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/LI355-2014fev/spip.php?page=opensearch.xml"
	title="PACS 2013 2014" />
<script type='text/javascript' src='https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/extensions/DidacSPIP/prive/javascript/admin_check.js'></script>
<title>3. Le temps du formulaire (PACS 2013 2014)</title>
</head><body class="default-parameters">
<div id="navigation-upmc">
	<div class="menu-lv1">
		<a class='menu-logo' href='https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/ecrire/'
			title='Espace priv&eacute;'>Espace priv&eacute;</a>
	</div>
	<div class="menu-lv1"><a href="http://www.upmc.fr" title="Universit&eacute; Pierre et Marie Curie">UPMC</a></div>
	<div class='menu-lv1 fs80'><a href="https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev" title="Accueil du site">PACS 2013 2014</a></div>
	<div class="menu-lv1">
	<a href='pacs' title="Programmation des Architectures Clients-serveur">pacs</a>
</div>


<div class="menu-lv1">Navigation dans la page</div><ul class="menu-lv1">
<li class="menu-lv2"><a href='#a1'>Affichage des valeurs transmises</a></li>
<li class="menu-lv2"><a href='#a2'>Conception d&#8217;un formulaire</a></li>
<li class="menu-lv2"><a href='#a3'>Contrôle des saisies</a></li>
<li class="menu-lv2"><a href='#a4'>Saisies indicées</a></li>
<li class="menu-lv2"><a href='#a5'>Gestion des notes des étudiants (1/2)</a></li>
<li class="menu-lv2"><a href='#a6'>Gestion des notes des étudiants (2/2)</a></li>
</ul>


<div class="menu-lv1"><form id="formulaire_recherche" action="https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/spip.php?page=recherche" method="get"><div>
<input name="page" value="recherche" type="hidden" />
<a href='.'
	onclick='addSearchProvider("https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/spip.php?page=opensearch.xml");return false'
	title='Utiliser le moteur de recherche OpenSearch'>O</a>
<label for='recherche' style='display:none'>Rechercher</label>
<input type="text" name="recherche" id='recherche' value="Rechercher" />
</div></form>
</div>	<div class="menu-lv1-last">&nbsp;</div>
</div><div id="content">

<h1>pacs&nbsp;: Travaux Dirig&eacute;s<br />3. Le temps du formulaire</h1>
<p>L&#8217;objectif de cette séance est  de comprendre le traitement de données par formulaire,  que la méthode soit GET ou POST.  PHP dispose pour cela des variables super globales $_GET et $_POST. Leur valeur doivent toujours être contrôlées, notamment pour éviter l&#8217;<i>attaque par injection de code</i>.
On étudiera  la possibilité de récupérer un nombre variable de données, à l&#8217;aide des sous-tableaux de saisies offerts par PHP.</p>

<p>Lorsqu&#8217;un script PHP est invoqué par la méthode <tt>get</tt> (celle par défaut), les valeurs transmises et leurs noms apparaissent dans l&#8217;adresse d&#8217;appel au serveur HTTP après un point d&#8217;interrogation, sous la forme d&#8217;une suite <i>nom=valeur&amp;</i>.  Cette suite est accessible en PHP par <tt>
$_SERVER[&#8217;QUERY_STRING&#8217;]</tt>, mais il est plus commode d&#8217;utiliser 
le tableau  $_GET qui contient les valeurs de la suite, indexées par le nom correspondant (il y a donc autant d&#8217;éléments dans $_GET que de signes = dans l&#8217;adresse).</p>
<br /><div id='sequence283'>
<span id='e2301'></span>


<h2 id='a1'>1 Affichage des valeurs transmises</h2>
<p>Ecrire d&#8217;abord une fonction <code class='spip_code'>arrayEnTableHTML</code> qui reçoit en argument un tableau PHP et une chaîne de caractères représentant le résumé de la table. La fonction renvoie une chaîne de caractères décrivant ce tableau sous forme d&#8217;une <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/struct/tables.html#edef-TABLE" class='spip_glossaire' title="Voir la description de 'table' dans la documentation de 'html'" rel='external'>table</a> HTML  de
deux colonnes (index et valeur).</p>

<p>Ecrire ensuite une fonction <code class='spip_code'>queryString</code> qui récupère le contenu de la <i>query string</i> et le renvoie sous forme d&#8217;un paragraphe (<a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/struct/text.html#edef-P" class='spip_glossaire' title="Voir la description de 'p' dans la documentation de 'html'" rel='external'>p</a>) HTML.</p>

<p> ATTENTION&nbsp;: si les données transmises contiennent chevrons,  apostrophes ou  guillemets, il y a un risque de produire une page HTML invalide ou illisble, et même pire&nbsp;: infectée par une <i>injection de code</i> malveillante. Pour éviter cela, utiliser la fonction <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/PHP/html/function.htmlspecialchars.html" class='spip_glossaire' title="Voir la description de 'htmlspecialchars' dans la documentation de 'php'" rel='external'>htmlspecialchars</a>, qui code en <i>entités XML</i> les caractères spéciaux de XML&nbsp;: 
&lt; en &amp;lt; &gt; en &amp;gt; " en &amp;quot; etc.</p>


<div class='solution'>
<div>Solution
<a href="https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/spip.php?action=acceder_document&amp;arg=720&amp;cle=76d28a5c0e4676e47a4cfa1938091715b39cc785&amp;file=distant%2FVCS%2FLI355%2FTD%2F3%2FShowForm.php"
      style='float:right'
      class='solution'>T&eacute;l&eacute;charger ShowForm.php</a>
</div>
<p><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;La&nbsp;fonction&nbsp;demandee&nbsp;est&nbsp;la&nbsp;meme&nbsp;qu'au&nbsp;TME&nbsp;2<br />//&nbsp;sauf&nbsp;qu'il&nbsp;faut&nbsp;neutraliser&nbsp;les&nbsp;caracteres&nbsp;speciaux&nbsp;des&nbsp;saisies.<br /><br /></span><span style="color: #007700">include(</span><span style="color: #DD0000">'../../TM/2/tableau_en_table.php'</span><span style="color: #007700">);<br /><br />function&nbsp;</span><span style="color: #0000BB">arrayEnTableHTML</span><span style="color: #007700">(</span><span style="color: #0000BB">$t</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$legende</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$r&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Le&nbsp;tableau&nbsp;etant&nbsp;des&nbsp;saisies&nbsp;de&nbsp;l'utilisateur<br />&nbsp;&nbsp;//&nbsp;il&nbsp;faut&nbsp;se&nbsp;mefier&nbsp;de&nbsp;ce&nbsp;qu'il&nbsp;a&nbsp;pu&nbsp;ecrire&nbsp;comme&nbsp;"&lt;"&nbsp;etc<br />&nbsp;&nbsp;//&nbsp;y&nbsp;compris&nbsp;pour&nbsp;les&nbsp;index&nbsp;qui&nbsp;peuvent&nbsp;resulter&nbsp;d'une&nbsp;query-string&nbsp;ad&nbsp;hoc<br />&nbsp;&nbsp;</span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$t&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$k&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">$r</span><span style="color: #007700">[</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$k</span><span style="color: #007700">)]&nbsp;=&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$v</span><span style="color: #007700">);<br />&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;A&nbsp;l'inverse,&nbsp;la&nbsp;legende&nbsp;etant&nbsp;fournie&nbsp;par&nbsp;le&nbsp;programmeur<br />&nbsp;&nbsp;//&nbsp;on&nbsp;fait&nbsp;confiance&nbsp;aux&nbsp;chevrons&nbsp;qui&nbsp;y&nbsp;figurent,&nbsp;on&nbsp;ne&nbsp;transcode&nbsp;pas.<br />&nbsp;&nbsp;//&nbsp;cf&nbsp;exemple&nbsp;ci-dessous<br />&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;</span><span style="color: #0000BB">tableau_en_table</span><span style="color: #007700">(</span><span style="color: #0000BB">$r</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$legende</span><span style="color: #007700">);<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">queryString&nbsp;</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'QUERY_STRING'</span><span style="color: #007700">])&nbsp;.&nbsp;</span><span style="color: #DD0000">"&lt;/p&gt;"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #FF8000">//&nbsp;Test<br />//&nbsp;include('../../TM/2/entete.php');<br />//&nbsp;echo&nbsp;entete('ShowForm'),&nbsp;'&lt;body&gt;';<br />//&nbsp;echo&nbsp;queryString&nbsp;();<br />//&nbsp;echo&nbsp;arrayEnTableHTML($_GET,&nbsp;'&lt;code&gt;$_GET&lt;/code&gt;');<br />//&nbsp;echo&nbsp;'&lt;/body&gt;&lt;/html&gt;';<br /></span><span style="color: #0000BB">?&gt;<br /></span>
</span>
</code></p></div>


<span id='e2302'></span>


<h2 id='a2'>2 Conception d&#8217;un formulaire</h2>
<p>Pour transmettre des saisies volumineuses à un script PHP,
il faut utiliser une balise <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/interact/forms.html#edef-FORM" class='spip_glossaire' title="Voir la description de 'form' dans la documentation de 'html'" rel='external'>form</a>,  indiquer dans son attribut <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/interact/forms.html#adef-action" class='spip_glossaire' title="Voir la description de 'action' dans la documentation de 'html' section 1" rel='external'>action</a> l&#8217;adresse du script, et
mettre dans son attribut <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/interact/forms.html#adef-method" class='spip_glossaire' title="Voir la description de 'method' dans la documentation de 'html' section 1" rel='external'>method</a> la valeur <tt>post</tt> (autrement la méthode sera <tt>get</tt>, qui ne fonctionne qu&#8217;en cas de saisies courtes).
On peut écrire une page HTML contenant cette balise <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/interact/forms.html#edef-FORM" class='spip_glossaire' title="Voir la description de 'form' dans la documentation de 'html'" rel='external'>form</a>, mais une bonne discipline de développement consiste plutôt à n&#8217;écrire qu&#8217;un seul fichier, en considérant qu&#8217;un appel du script sans transmission de valeur vaut demande du formulaire. Ce schéma n&#8217;est donc pas obligatoire mais il limite le risque d&#8217;oubli de changer  la réception  lorsque l&#8217;on change l&#8217;envoi et réciproquement.</p>

<p>Pour savoir si une saisie de nom <i>x</i> a été envoyée dans un formulaire en méthode POST, il faut appliquer la fonction PHP <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/PHP/html/function.isset.html" class='spip_glossaire' title="Voir la description de 'isset' dans la documentation de 'php'" rel='external'>isset</a>&nbsp;sur l&#8217;index <i>x</i> du tableau <tt>$_POST</tt>,  ce qui donne <tt>isset($_POST[&#8217;</tt><i>x</i><tt>&#8217;])</tt>. De même pour <tt>$_GET</tt>.</p>

<p>Ecrire un script <tt>etudiant.php</tt> supposé recevoir une saisie nommée <tt>mail</tt> et une autre nommée <tt>id</tt>. Si les deux saisies sont présentes, le script les affiche à l&#8217;aide de la fonction arrayEnTableHTML définie dans l&#8217;exercice précédent, que la méthode soit <tt>get</tt> ou <tt>post</tt>. Sinon,  le script renvoie un formulaire permettant de saisir ces deux informations, puis de les envoyer (avec une balise <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/interact/forms.html#edef-INPUT" class='spip_glossaire' title="Voir la description de 'input' dans la documentation de 'html'" rel='external'>input</a>&nbsp;de type <tt>submit</tt> sans attribut <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/index/elements.html" class='spip_glossaire' title="Voir la description de 'name' dans la documentation de 'html'" rel='external'>name</a>). Afin d&#8217;avoir un formulaire conforme au Doctype XHTML Basic, ces balises  <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/interact/forms.html#edef-INPUT" class='spip_glossaire' title="Voir la description de 'input' dans la documentation de 'html'" rel='external'>input</a> seront regroupées dans une balise <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/interact/forms.html#edef-FIELDSET" class='spip_glossaire' title="html" rel='external'>fieldset</a>, et on utilisera systématiquement une balise <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/interact/forms.html#edef-LABEL" class='spip_glossaire' title="html" rel='external'>label</a> pour respecter les règles d&#8217;accessibilité.</p>


<div class='solution'>
<div>Solution
<a href="https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/spip.php?action=acceder_document&amp;arg=722&amp;cle=02c456ca6efa0c46ac185d6d208e132114da89d5&amp;file=distant%2FVCS%2FLI355%2FTD%2F3%2Fetudiant.php"
      style='float:right'
      class='solution'>T&eacute;l&eacute;charger etudiant.php</a>
</div>
<p><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">E_ALL</span><span style="color: #007700">);<br />require_once(</span><span style="color: #DD0000">"../../TM/2/entete.php"</span><span style="color: #007700">);<br />require_once(</span><span style="color: #DD0000">'ShowForm.php'</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">entete</span><span style="color: #007700">(</span><span style="color: #DD0000">"Etudiant"</span><span style="color: #007700">);<br />echo&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;body&gt;\n"</span><span style="color: #007700">,</span><span style="color: #DD0000">"&lt;h1&gt;Etudiant&lt;/h1&gt;\n"</span><span style="color: #007700">;<br />if&nbsp;(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'mail'</span><span style="color: #007700">])&nbsp;AND&nbsp;isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])&nbsp;AND&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'mail'</span><span style="color: #007700">])&nbsp;AND&nbsp;!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])){<br />&nbsp;echo&nbsp;</span><span style="color: #0000BB">arrayEnTableHTML</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"Informations"</span><span style="color: #007700">);<br />}&nbsp;else&nbsp;{<br />&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;form&nbsp;action=''&nbsp;method='post'&gt;&lt;fieldset&gt;\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;label&nbsp;for='id'&gt;Identifiant&nbsp;:&lt;/label&gt;"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;id='id'&nbsp;name='id'&nbsp;/&gt;\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;label&nbsp;for='mail'&gt;Mail&nbsp;:&lt;/label&gt;"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;id='mail'&nbsp;name='mail'&nbsp;/&gt;\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type='submit'&nbsp;value='Envoyer'&gt;\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;/fieldset&gt;&lt;/form&gt;\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;<br /></span>&lt;/body&gt;<br />&lt;/html&gt;<br /><br /></span>
</code></p></div>


<span id='e2304'></span>


<h2 id='a3'>3 Contrôle des saisies</h2>
<p>On souhaite maintenant vérifier que les saisies transmises sont correctes. 
Commencer par définir les fonctions suivantes&nbsp;:</p>

<ul class="spip"><li> <code class='spip_code'>validerNuEtudiant</code> qui vérifie, à l&#8217;aide de <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/PHP/html/function.preg-match.html" class='spip_glossaire' title="Voir la description de 'preg_match' dans la documentation de 'php'" rel='external'>preg_match</a>, que son argument est un numéro de 7 chiffres.</li></ul>
<ul class="spip"><li> <code class='spip_code'>validerMail</code> qui vérifie que son argument est bien composé d&#8217;un nom simple ou composé suivi d&#8217;un point, puis d&#8217;un prénom simple ou composé, suivi de <code class='spip_code'>@etu.upmc.fr</code>.</li></ul>
<p>Ensuite, changer le script précédent, de sorte que le formulaire est renvoyé si l&#8217;une au moins des saisies est incorrecte. Pour la saisie correcte, on pré-remplit l&#8217;attribut <a href="http://fr.wikipedia.org/wiki/value" class='spip_glossaire' title="Voir la description de 'value' dans la documentation de 'htim' section 1" rel='external'>value</a> de sa balise <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/interact/forms.html#edef-INPUT" class='spip_glossaire' title="Voir la description de 'input' dans la documentation de 'html'" rel='external'>input</a> avec cette valeur, pour l&#8217;autre saisie on le laisse vide.</p>


<div class='solution'>
<div>Solution
<a href="https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/spip.php?action=acceder_document&amp;arg=721&amp;cle=a9fa2c2708296a15ed4ed526415a80c750643991&amp;file=distant%2FVCS%2FLI355%2FTD%2F3%2FcontroleSaisies.php"
      style='float:right'
      class='solution'>T&eacute;l&eacute;charger controleSaisies.php</a>
</div>
<p><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">require_once(</span><span style="color: #DD0000">"../../TM/2/entete.php"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">E_ALL</span><span style="color: #007700">);<br />require(</span><span style="color: #DD0000">'ShowForm.php'</span><span style="color: #007700">);<br /><br />function&nbsp;</span><span style="color: #0000BB">validerNuEtudiant</span><span style="color: #007700">(</span><span style="color: #0000BB">$nu</span><span style="color: #007700">){<br />&nbsp;return&nbsp;</span><span style="color: #0000BB">preg_match</span><span style="color: #007700">(</span><span style="color: #DD0000">"/^[0-9]{7}$/"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$nu</span><span style="color: #007700">);<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">validerMail</span><span style="color: #007700">(</span><span style="color: #0000BB">$mail</span><span style="color: #007700">){<br />&nbsp;</span><span style="color: #0000BB">$re&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'[A-Z][a-z]+'</span><span style="color: #007700">;<br />&nbsp;</span><span style="color: #0000BB">$re&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"$re(-$re)?"</span><span style="color: #007700">;<br />&nbsp;</span><span style="color: #FF8000">//&nbsp;Ne&nbsp;pas&nbsp;écrire&nbsp;"/^$re[.]",&nbsp;PHP&nbsp;fait&nbsp;une&nbsp;erreur<br />&nbsp;//&nbsp;si&nbsp;on&nbsp;veut&nbsp;[.]&nbsp;mettre&nbsp;"/^"&nbsp;.&nbsp;$r&nbsp;.&nbsp;"[.].....<br />&nbsp;</span><span style="color: #0000BB">$re&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"/^$re\.$re@etu\.upmc\.fr$/"</span><span style="color: #007700">;<br /><br />&nbsp;return&nbsp;</span><span style="color: #0000BB">preg_match</span><span style="color: #007700">(</span><span style="color: #0000BB">$re</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mail</span><span style="color: #007700">);<br />}<br /><br />echo&nbsp;</span><span style="color: #0000BB">entete</span><span style="color: #007700">(</span><span style="color: #DD0000">"Etudiant"</span><span style="color: #007700">);<br /><br />echo&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;body&gt;\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"&lt;h1&gt;Etudiant&lt;/h1&gt;\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$mail&nbsp;</span><span style="color: #007700">=&nbsp;(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'mail'</span><span style="color: #007700">])&nbsp;AND&nbsp;</span><span style="color: #0000BB">validerMail</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'mail'</span><span style="color: #007700">]))<br />&nbsp;?&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'mail'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$id&nbsp;</span><span style="color: #007700">=&nbsp;(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])&nbsp;AND&nbsp;</span><span style="color: #0000BB">validerNuEtudiant</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]))<br />&nbsp;?&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br /><br />if&nbsp;(</span><span style="color: #0000BB">$mail&nbsp;</span><span style="color: #007700">AND&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">)<br />&nbsp;echo&nbsp;</span><span style="color: #0000BB">arrayEnTableHTML</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"Informations&nbsp;&amp;eacute;tudiant"</span><span style="color: #007700">);<br />else<br />&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;form&nbsp;action=''&nbsp;method='post'&gt;&lt;fieldset&gt;\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;label&nbsp;for='id'&gt;Identifiant&nbsp;:&lt;/label&gt;"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;id='id'&nbsp;name='id'&nbsp;value='"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"'&nbsp;/&gt;\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;label&nbsp;for='mail'&gt;Mail&nbsp;:&lt;/label&gt;"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;id='mail'&nbsp;name='mail'&nbsp;value='"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$mail</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">"'&nbsp;/&gt;\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type='submit'&nbsp;value='Envoyer'&gt;\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;/fieldset&gt;&lt;/form&gt;\n"</span><span style="color: #007700">;<br /><br />echo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;/body&gt;\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;/html&gt;\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;<br /></span>
</span>
</code></p></div>


<span id='e2303'></span>


<h2 id='a4'>4 Saisies indicées</h2>
<p>Dans certaines situations, un formulaire doit proposer plusieurs cases à cocher, l&#8217;utilisateur étant libre d&#8217;en choisir le nombre effectivement cochées. Pour le script de réception, la difficulté est de savoir quel est ce nombre.
Or PHP autorise un attribut <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/types.html#type-name" class='spip_glossaire' title="Voir la description de 'name' dans la documentation de 'html' section 1" rel='external'>name</a>&nbsp;à avoir une valeur utilisant des crochets, comme dans <tt>&lt;input name=&#8217;t[]&#8217; type=&#8217;checkbox&#8217; /&gt;</tt>, ce qui provoque  la création d&#8217;un sous-tableau d&#8217;indice <tt>t</tt> dans le tableau <tt>$_GET</tt> et ses congénères. Ce sous-tableau sera indexé numériquement à partir de 0, et aura autant d&#8217;éléments que de cases cochées lors de l&#8217;envoi. La valeur associée est celle de l&#8217;attribut <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/interact/forms.html#adef-value-INPUT" class='spip_glossaire' title="Voir la description de 'value' dans la documentation de 'html' section 1" rel='external'>value</a>, ou <tt>on</tt> s&#8217;il est absent.</p>

<p>Ecrire une fonction <code class='spip_code'>arrayEnListeHTML</code> qui reçoit en argument un tableau associatif PHP et renvoie une chaîne de caractères représentant l&#8217;ensemble des clefs du tableau sous forme d&#8217;une liste <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/struct/lists.html#edef-UL" class='spip_glossaire' title="Voir la description de 'ul' dans la documentation de 'html'" rel='external'>ul</a> HTML.</p>

<p>Ecrire ensuite un script qui, en l&#8217;absence de saisie, envoie un formulaire  listant des choix à cocher (par exemple des enseignements), et qui sinon visualise ceux retenus par les saisies à l&#8217;aide la fonction <code class='spip_code'>arrayEnListeHTML</code>.</p>


<div class='solution'>
<div>Solution
<a href="https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/spip.php?action=acceder_document&amp;arg=724&amp;cle=d1eb27347363b71ee736ca4f4941fdc242e36d25&amp;file=distant%2FVCS%2FLI355%2FTD%2F3%2FsaisiesIndicees.php"
      style='float:right'
      class='solution'>T&eacute;l&eacute;charger saisiesIndicees.php</a>
</div>
<p><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php&nbsp;<br /></span><span style="color: #007700">require_once(</span><span style="color: #DD0000">"../../TM/2/entete.php"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">E_ALL</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$ens&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'LI326'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI348'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI362'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'LI314'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI328'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI350'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI355'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'LI316'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI334'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI351'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'LI320'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI335'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI353'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'LI322'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI336'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI354'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'LI323'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI339'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI369'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'LI324'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI344'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI356'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'LI325'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI345'</span><span style="color: #007700">,&nbsp;&nbsp;</span><span style="color: #DD0000">'LI357'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">);<br /><br />function&nbsp;</span><span style="color: #0000BB">arrayEnListeHTML</span><span style="color: #007700">(</span><span style="color: #0000BB">$tableauPHP</span><span style="color: #007700">){<br />&nbsp;&nbsp;</span><span style="color: #0000BB">$resultat&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br />&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$tableauPHP&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$k&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">){&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$resultat&nbsp;</span><span style="color: #007700">.=&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;li&gt;$k&lt;/li&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;return&nbsp;&nbsp;</span><span style="color: #0000BB">$resultat&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #DD0000">"&lt;ul&gt;$resultat&lt;/ul&gt;"&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />}<br /><br />echo&nbsp;</span><span style="color: #0000BB">entete</span><span style="color: #007700">(</span><span style="color: #DD0000">"Enseignements"</span><span style="color: #007700">);<br />echo&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;body&gt;\n"</span><span style="color: #007700">,</span><span style="color: #DD0000">"&lt;h1&gt;Enseignements&lt;/h1&gt;\n"</span><span style="color: #007700">;<br /><br />if&nbsp;(empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'ens'</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;form&nbsp;action=''&nbsp;method='post'&gt;&lt;fieldset&gt;\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;label&nbsp;for='ens'&gt;Enseignements&nbsp;:&lt;/label&gt;&lt;ul&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$ens&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$nom</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;li&gt;&lt;input&nbsp;id='ens-$nom'&nbsp;name='ens[$nom]'&nbsp;type='checkbox'&nbsp;/&gt;&nbsp;$nom&lt;/li&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;echo&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;/ul&gt;&lt;input&nbsp;type='submit'&nbsp;value='Envoyer'&gt;\n&lt;/fieldset&gt;&lt;/form&gt;\n"</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">arrayEnListeHTML</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'ens'</span><span style="color: #007700">]);&nbsp;&nbsp;<br />}<br /></span><span style="color: #0000BB">?&gt;<br /></span>&lt;/body&gt;<br />&lt;/html&gt;<br /><br /></span>
</code></p></div>


<span id='e2762'></span>


<h2 id='a5'>5 Gestion des notes des étudiants (1/2)</h2>
<p>Dans cet exercice et dans l&#8217;exercice suivant, on se propose d&#8217;écrire une petite application permettant de gérer les notes d&#8217;un groupe d&#8217;étudiants, à l&#8217;aide de deux scripts PHP de noms <tt>entrerNotes</tt> et <tt>notesEntrees</tt>.</p>

<p><b>Question 1</b><br />
Nous allons donc dans un premier temps écrire un script PHP <tt>entrerNotes</tt>. A son premier appel, ce script renvoie un formulaire demandant le numéro du groupe concerné.
Les saisies sont à  renvoyer en méthode <tt>get</tt>, 
et il  est reproposé (avec un message d&#8217;erreur) si  le numéro de groupe&nbsp;:</p>

<ul class="spip"><li> n&#8217;a pas été saisi,</li><li> ou est supérieur à une constante définie dans le script.</li></ul>
<p><b>Question 2</b><br />
Lorsque le numéro de groupe a été correctement entré, ce même script <tt>entrerNotes</tt> envoie alors un formulaire comportant autant de zones de saisie de notes que d&#8217;étudiants, ainsi que le nom des étudiants.
Les saisies sont à renvoyer en méthode <tt>post</tt>, et seront traitées par le script <tt>notesEntrees</tt> qui fait l&#8217;objet de l&#8217;exercice suivant.</p>

<p>On supposera dans un premier temps que la liste des étudiants se trouve dans un tableau figurant dans le script, mais bien sûr, votre script doit être valable quel que soit le nombre d’étudiants.</p>

<p>Écrire le script <tt>entrerNotes</tt>.</p>


<div class='solution'>
<div>Solution
<a href="https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/spip.php?action=acceder_document&amp;arg=749&amp;cle=ab6f1a35f6a10abf984909fd79cd82380ac321de&amp;file=distant%2FVCS%2FLI355%2FTD%2F3%2FentrerNotes.php"
      style='float:right'
      class='solution'>T&eacute;l&eacute;charger entrerNotes.php</a>
</div>
<p><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #FF8000">//&nbsp;entrerNotes.php<br /></span><span style="color: #007700">require_once(</span><span style="color: #DD0000">"../../TM/2/entete.php"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">E_ALL</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">define</span><span style="color: #007700">(</span><span style="color: #DD0000">"NBTD"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$listeEtudiantsTDn</span><span style="color: #007700">=array(</span><span style="color: #DD0000">"Dupond"</span><span style="color: #007700">,</span><span style="color: #DD0000">"Dupont"</span><span style="color: #007700">,</span><span style="color: #DD0000">"Castafiore"</span><span style="color: #007700">,</span><span style="color: #DD0000">"Haddock"</span><span style="color: #007700">,</span><span style="color: #DD0000">"Hergé"</span><span style="color: #007700">,&nbsp;<br /></span><span style="color: #DD0000">"Milou"</span><span style="color: #007700">,</span><span style="color: #DD0000">"Tintin"</span><span style="color: #007700">,</span><span style="color: #DD0000">"Tournesol"</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #0000BB">entete</span><span style="color: #007700">(</span><span style="color: #DD0000">"Formulaires&nbsp;numTD&nbsp;puis&nbsp;notes"</span><span style="color: #007700">);<br /><br />echo&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;body&gt;\n"</span><span style="color: #007700">;<br /><br />if&nbsp;(empty(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'td'</span><span style="color: #007700">])&nbsp;OR&nbsp;(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'td'</span><span style="color: #007700">]&nbsp;&gt;&nbsp;</span><span style="color: #0000BB">NBTD</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#echo&nbsp;"vous&nbsp;avez&nbsp;peut-être&nbsp;oublié&nbsp;d'envoyer&nbsp;le&nbsp;formulaire"."\n";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#echo&nbsp;"ou&nbsp;vous&nbsp;avez&nbsp;oublié&nbsp;de&nbsp;rentrer&nbsp;le&nbsp;numéro&nbsp;d'un&nbsp;TD"."\n";<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#echo&nbsp;"ou&nbsp;le&nbsp;TD&nbsp;".$_GET['td']."&nbsp;n'existe&nbsp;pas"."\n";<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">'&lt;form&nbsp;action="entrerNotes.php"&nbsp;method="get"&gt;&lt;fieldset&gt;'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;label&nbsp;for='td'&gt;groupe&nbsp;de&nbsp;TD&lt;/label&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type='text'&nbsp;size&nbsp;='2'&nbsp;name='td'&nbsp;id='td'&gt;&nbsp;&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'&lt;input&nbsp;type="submit"&nbsp;value="Envoyer"&gt;&nbsp;&lt;br&nbsp;/&gt;'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'&lt;/fieldset&gt;&lt;/form&gt;'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;form&nbsp;action='notesEntrees.php'&nbsp;method='post'&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'&lt;table&gt;'</span><span style="color: #007700">;<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;tr&gt;&nbsp;&lt;th&gt;Nom&lt;/th&gt;&lt;th&gt;Note&lt;/th&gt;&lt;/tr&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$listeEtudiantsTDn</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;tr&nbsp;style='background-color:#"</span><span style="color: #007700">,&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">%</span><span style="color: #0000BB">2&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">777&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">999</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"'&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;td&gt;&lt;input&nbsp;type='text'&nbsp;size&nbsp;='10'&nbsp;name='etu[]'&nbsp;value='"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$listeEtudiantsTDn</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">].&nbsp;</span><span style="color: #DD0000">"'&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;/td&gt;\n&lt;td&gt;&nbsp;&lt;input&nbsp;type='text'&nbsp;size&nbsp;='5'&nbsp;name='note[]'&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;/td&gt;&lt;/tr&gt;&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'&lt;/table&gt;'</span><span style="color: #007700">;<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;div&gt;&lt;input&nbsp;type='submit'&nbsp;value='Envoyer'&gt;&nbsp;&lt;/div&gt;\n"</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'&lt;form&gt;'</span><span style="color: #007700">;<br />&nbsp;&nbsp;}<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;/body&gt;&lt;/html&gt;\n"<br /></span><span style="color: #0000BB">?&gt;<br /></span>
</span>
</code></p></div>


<span id='e3505'></span>


<h2 id='a6'>6 Gestion des notes des étudiants (2/2)</h2>
<p>Avant d&#8217;écrire le script <tt>notesEntrees</tt>, écrire une fonction noteValide qui vérifie, à l’aide de <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/PHP/html/function.preg-match.html" class='spip_glossaire' title="Voir la description de 'preg_match' dans la documentation de 'php'" rel='external'>preg_match</a> si une note est valide ou pas. Les notes valides sont&nbsp;:</p>

<ul class="spip"><li> comprises entre 0 et 20&nbsp;;</li><li> le point (et non la virgule) est autorisé&nbsp;;</li><li> les seules décimales autorisées sont 25, 50 (ou 5) et 75.</li></ul>
<p>Le script <tt>notesEntrees</tt> affiche sous  forme de tableau HTML, la liste des étudiants, leur note, la moyenne du TD et les notes non valides.</p>

<p>Ecrire une fonction <tt>moyenne</tt> qui prend en argument un tableau PHP contenant les notes sous forme de chaîne de caractères et qui renvoie la moyenne. Attention, seuls les notes valides sont comptabilisés pour le calcul de la moyenne.</p>

<p>Ecrire une fonction <tt>notesNonValidesEnListe</tt> qui prend en argument deux tableaux PHP (un tableau représentant la liste des étudiants et un autre leur note), et qui renvoie une liste <a href="http://www-ari.ufr-info-p6.jussieu.fr/OUTILS/documentation/doc/html4/struct/lists.html#edef-UL" class='spip_glossaire' title="Voir la description de 'ul' dans la documentation de 'html'" rel='external'>ul</a> HTML d&#8217;étudiants ayant une note non valide.</p>

<p>Ecrire une fonction <tt>genererTableHTML</tt> qui prend en argument deux tableaux PHP (un tableau représentant la liste des étudiants et un autre leur note), et qui renvoie une table HTML affichant ces informations.</p>

<p>Écrire le script <tt>notesEntrees</tt> qui affiche sous  forme de table HTML, la liste des étudiants, leur note, la moyenne du TD et les notes non valides.</p>


<div class='solution'>
<div>Solution
<a href="https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/pacs-2014fev/spip.php?action=acceder_document&amp;arg=750&amp;cle=97654101ce79bc7fdd078327bbdeaa0c118c82fa&amp;file=distant%2FVCS%2FLI355%2FTD%2F3%2FnotesEntrees.php"
      style='float:right'
      class='solution'>T&eacute;l&eacute;charger notesEntrees.php</a>
</div>
<p><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #FF8000">//&nbsp;notesEntrees.php<br /></span><span style="color: #007700">require_once(</span><span style="color: #DD0000">"../../TM/2/entete.php"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">E_ALL</span><span style="color: #007700">);<br /><br />function&nbsp;</span><span style="color: #0000BB">noteValide</span><span style="color: #007700">(</span><span style="color: #0000BB">$note</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">preg_match</span><span style="color: #007700">(</span><span style="color: #DD0000">"/^(([0-1]?[0-9])|20)(\.(25|50|5|75))?$/"</span><span style="color: #007700">,</span><span style="color: #0000BB">$note</span><span style="color: #007700">);<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;<br />function&nbsp;</span><span style="color: #0000BB">moyenne</span><span style="color: #007700">(</span><span style="color: #0000BB">$notes</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$nombreNoteValides&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$somme&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$notes</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">noteValide</span><span style="color: #007700">(</span><span style="color: #0000BB">$notes</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">])){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$nombreNoteValides</span><span style="color: #007700">++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$somme&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$somme&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">$notes</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$somme&nbsp;</span><span style="color: #007700">/&nbsp;</span><span style="color: #0000BB">$nombreNoteValides</span><span style="color: #007700">;<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;<br />function&nbsp;</span><span style="color: #0000BB">notesNonValidesEnListe</span><span style="color: #007700">(</span><span style="color: #0000BB">$etudiants</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$notes</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$liste&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$notes</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">noteValide</span><span style="color: #007700">(</span><span style="color: #0000BB">$notes</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">])){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$liste&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;li&gt;Etudiant&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$etudiants</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;:&nbsp;note&nbsp;invalide.&lt;/li&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$liste&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #DD0000">"&lt;ul&gt;$liste&lt;/ul&gt;"&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;<br />function&nbsp;</span><span style="color: #0000BB">genererTableHTML</span><span style="color: #007700">(</span><span style="color: #0000BB">$etudiants</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$notes</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$etudiants</span><span style="color: #007700">)&nbsp;!=&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$notes</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"&lt;p&gt;Erreur&nbsp;:&nbsp;le&nbsp;nombre&nbsp;de&nbsp;notes&nbsp;est&nbsp;différent&nbsp;du&nbsp;nombre&nbsp;des&nbsp;étudiants.&lt;/p&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$etudiants</span><span style="color: #007700">);&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$c&nbsp;</span><span style="color: #007700">=&nbsp;(</span><span style="color: #0000BB">$i</span><span style="color: #007700">%</span><span style="color: #0000BB">2&nbsp;</span><span style="color: #007700">?&nbsp;</span><span style="color: #0000BB">777&nbsp;</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">999</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$e&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$etudiants</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$n&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$notes</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$table&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">"&lt;tr&nbsp;style='background-color:#$c'&gt;&lt;td&gt;$e&lt;/td&gt;&lt;td&gt;$n&lt;/td&gt;&lt;/tr&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$table</span><span style="color: #007700">)&nbsp;return&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">"&lt;table&nbsp;summary=\"Notes&nbsp;étudiants\"&gt;\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"&lt;caption&gt;Notes&nbsp;étudiants&lt;/caption&gt;\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.</span><span style="color: #DD0000">"&nbsp;&lt;tr&gt;&lt;th&gt;Nom&lt;/th&gt;&lt;th&gt;Note&lt;/th&gt;&lt;/tr&gt;\n"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$table<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"&lt;/table&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;<br />}<br /><br />echo&nbsp;</span><span style="color: #0000BB">entete</span><span style="color: #007700">(</span><span style="color: #DD0000">"Les&nbsp;notes&nbsp;et&nbsp;la&nbsp;moyenne&nbsp;obtenue"</span><span style="color: #007700">);<br />echo&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"&lt;body&gt;\n"</span><span style="color: #007700">;<br />if&nbsp;(isset(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"etu"</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">genererTableHTML</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"etu"</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"note"</span><span style="color: #007700">]);<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;div&gt;Moyenne&nbsp;obtenue&nbsp;:&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">moyenne</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"note"</span><span style="color: #007700">]),&nbsp;</span><span style="color: #DD0000">"&lt;/div&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">notesNonValidesEnListe</span><span style="color: #007700">(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"etu"</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">"note"</span><span style="color: #007700">]);<br />}&nbsp;else&nbsp;</span><span style="color: #DD0000">"&lt;div&gt;Aucune&nbsp;note&lt;/div&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;<br /></span>&lt;/body&gt;<br />&lt;/html&gt;<br /></span>
</code></p></div>



</div><div id='pied' class='pied_page'><ul>
<li><a href="http://jigsaw.w3.org/css-validator/validator?uri=https%3A%2F%2Fwww-licence.ufr-info-p6.jussieu.fr%2Flmd%2Flicence%2F2013%2Fue%2FLI355-2014fev%2FLe-temps-du-formulaire"
	rel='noindex nofollow'
	class='validation-css'
	title='v&eacute;rifier la validit&eacute; CSS 2.1'>Valid CSS 2.1</a></li>
<li><a href='http://validator.w3.org/check?uri=https%3A%2F%2Fwww-licence.ufr-info-p6.jussieu.fr%2Flmd%2Flicence%2F2013%2Fue%2FLI355-2014fev%2FLe-temps-du-formulaire'
	class='validation-xml'
	rel='noindex nofollow'
	title='v&eacute;rifier la validit&eacute; XHTML Baisc 1.1'>Valid XHTML Basic 1.1</a></li>
<li><a href='http://www.contentquality.com/Default.asp?Url1=https%3A%2F%2Fwww-licence.ufr-info-p6.jussieu.fr%2Flmd%2Flicence%2F2013%2Fue%2FLI355-2014fev%2FLe-temps-du-formulaire&amp;rptmode=2'
	 class='validation-wcag'
	title='v&eacute;rifier la validit&eacute; WCAG 2.0 AAA'>Triple-A conformance Web Content Accessibility Guidelines 2.0</a></li>
<li class='date-publi'>
Calcul&eacute; le 13 mai 2014 &agrave; 12h21min<br />
par 
<a href='https://www-licence.ufr-info-p6.jussieu.fr/lmd/licence/2013/ue/LI355-2014fev/spip.php?page=auteur&amp;id_auteur=1&amp;sujet=Signaler%20un%20souci%20technique%20avec%20le%20site%20PACS%202013%202014' 
	rel='noindex nofollow'
	title='Signaler un souci technique avec le site'>DidacSPIP</a><br />
Universit&eacute; Pierre et Marie Curie
</li>
<li><a href='http://validator.w3.org/mobile/check?docAddr=https%3A%2F%2Fwww-licence.ufr-info-p6.jussieu.fr%2Flmd%2Flicence%2F2013%2Fue%2FLI355-2014fev%2FLe-temps-du-formulaire'
	class='mobile-ok'
	rel='noindex nofollow'
	title='v&eacute;rifier la validit&eacute; Mobile OK'>Mobile OK</a></li>
<li><a href='http://www.spip.net'
	class='reference-spip'
	title='Visiter SPIP'>SPIP</a></li>
<li><a href="http://prefetch.validatorsearch.verisignlabs.com"
	rel='noindex nofollow'
	title='voir http://validatorsearch.verisignlabs.com/'></a></li>
</ul></div></div></body>
</html>
